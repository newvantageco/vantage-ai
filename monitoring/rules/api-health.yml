groups:
- name: vantage-api-health
  rules:
  - alert: APIHealthCheckFailed
    expr: up{job="vantage-api"} == 0
    for: 1m
    labels:
      severity: critical
    annotations:
      summary: "VANTAGE API is down"
      description: "API health check has been failing for more than 1 minute"

  - alert: APIHighErrorRate
    expr: rate(http_requests_total{status=~"5.."}[5m]) > 0.1
    for: 2m
    labels:
      severity: warning
    annotations:
      summary: "High API error rate"
      description: "API error rate is above 10% for more than 2 minutes"

  - alert: APIHighResponseTime
    expr: histogram_quantile(0.95, rate(http_request_duration_seconds_bucket[5m])) > 2
    for: 5m
    labels:
      severity: warning
    annotations:
      summary: "High API response time"
      description: "95th percentile response time is above 2 seconds"

  - alert: APIMemoryUsage
    expr: container_memory_usage_bytes{name="vantage-api-prod"} / container_spec_memory_limit_bytes{name="vantage-api-prod"} > 0.8
    for: 5m
    labels:
      severity: warning
    annotations:
      summary: "High API memory usage"
      description: "API memory usage is above 80%"

  - alert: APICPUUsage
    expr: rate(container_cpu_usage_seconds_total{name="vantage-api-prod"}[5m]) > 0.8
    for: 5m
    labels:
      severity: warning
    annotations:
      summary: "High API CPU usage"
      description: "API CPU usage is above 80%"
